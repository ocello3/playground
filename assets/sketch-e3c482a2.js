import{t as v,s as F,D as j,c as P,d as b}from"./tools-365e5452.js";import{p as c}from"./index-f74d983d.js";const p=()=>({num:10,gravity:9.8,windF:5,massMin:10,massMax:20,velXmax:5,velYmax:5,bufferRate:.95,bufferRateMin:.9,fontSizeRate:.007}),D=p(),C=(t,e)=>{const s=e.pages[1];s.addBinding(t,"windF",{min:0,max:10}),s.addBinding(t,"bufferRate",{min:t.bufferRateMin,max:1.1})},A=(t,e)=>{const{num:s,gravity:a,massMin:i,massMax:d,velXmax:o,velYmax:r}=t;return{movers:Array.from(Array(s),()=>{const n=v.map(Math.random(),0,1,i,d),w=(()=>{const u=Math.random()*o,m=Math.random()*r;return new c.Vector().set(u,m)})();return{mass:n,gravityAcc:new c.Vector().set(0,a/n),initVel:w,acc:new c.Vector().set(0,0),windAcc:new c.Vector().set(0,0),vel:w,pos:(()=>{const u=Math.random()*e,m=Math.random()*e;return new c.Vector().set(u,m)})()}})}};A(D,100);const X=(t,e,s)=>{const{windF:a,bufferRate:i}=e,d={...t};return d.movers=t.movers.map(o=>{const r={...o};r.windAcc=new c.Vector(a/o.mass,0),r.acc=(()=>{const l=o.gravityAcc,u=r.windAcc;return c.Vector.add(l,u)})();const n=l=>c.Vector.add(o.pos,l),w=(l,u)=>{const m=c.Vector.add(o.vel,r.acc),f=l?m.x*-1*i:m.x,y=u?m.y*-1*i:m.y;return new c.Vector().set(f,y)};return r.vel=(()=>{const l=w(!1,!1),u=n(l),m=u.x<0||u.x>s,f=u.y>s;return w(m,f)})(),r.pos=(()=>{const l=n(r.vel),u=m=>m==="x"&&l[m]<0?0:l[m]>s?s:l[m];return new c.Vector().set(u("x"),u("y"))})(),r}),d},Y=(t,e,s,a)=>{const{fontSizeRate:i}=e;a.push();let d=0;for(const o of t.movers){const{pos:r,mass:n}=o;a.textSize(s*i*n),a.text(d,r.x,r.y),d++}a.pop()},h={setParams:p,setGui:C,setData:A,updateData:X,draw:Y},G=t=>({num:t.num,lengthMin:10,lengthMax:30,gravityRate:2,windRate:10,bufferAdjustRate:5,bufferBaseRate:.1}),L=G(D),O=(t,e)=>{e.pages[1].addBinding(t,"gravityRate",{step:.5,min:1,max:5})},S=(t,e)=>{const{num:s,lengthMin:a,lengthMax:i}=t;return{winds:Array.from(Array(s),()=>{const d=(()=>{const r=Math.random()*e,n=Math.random()*e;return new c.Vector().set(r,n)})();return{length:v.map(Math.random(),0,1,a,i),vec:new c.Vector().set(0,0),startPos:d,endPos:d,isReset:!1}})}};S(L,100);const q=(t,e,s,a,i)=>{const d={...t};return d.winds=t.winds.map((o,r)=>{const n={...o},w=e.movers[r],{lengthMin:l,lengthMax:u,gravityRate:m,windRate:f,bufferAdjustRate:y,bufferBaseRate:k}=s,{bufferRate:M,bufferRateMin:B}=a;return n.vec=(()=>{const x=(M-B+k)*y,V=c.Vector.mult(w.acc,M*x),_=new c.Vector().set(f,m);return c.Vector.mult(V,_)})(),n.length=(()=>o.isReset?v.map(Math.random(),0,1,l,u):o.length-c.Vector.mag(n.vec))(),n.isReset=(()=>o.isReset?!1:n.length<0)(),n.startPos=(()=>{if(n.isReset){const x=Math.random()*i,V=Math.random()*i;return new c.Vector().set(x,V)}return o.startPos})(),n.endPos=(()=>n.isReset?n.startPos:c.Vector.add(o.endPos,n.vec))(),n}),d},E=(t,e)=>{e.push(),e.strokeWeight(3),e.stroke(0,60);for(const s of t.winds){const{startPos:a,endPos:i}=s;e.line(a.x,a.y,i.x,i.y)}e.pop()},g={setParams:G,setGui:O,setData:S,updateData:q,draw:E},H=()=>({maxVolume:-10}),I=(t,e)=>{e.pages[2].addBinding(t,"maxVolume",{step:1,min:-60,max:0})},$=async()=>{const t=await F();return console.log(j.get()),{se:t}};await $();const J=(t,e)=>{console.log(t.se.get()),console.log(e)},R={setParams:H,setGui:I,setSynth:$,playSynth:J},Q=t=>{const e=v.setSize("sketch");let s=P.setController();const a=h.setParams(),i=g.setParams(a),d=R.setParams();let o=h.setData(a,e),r=g.setData(i,e),n;t.setup=async()=>{t.createCanvas(e,e),n=await R.setSynth();const w=P.setGui(t,s,n.se,!1);h.setGui(a,w),g.setGui(i,w),R.setGui(d,w),t.noLoop(),b(t,e)},t.draw=()=>{n===void 0&&t.noLoop(),t.background(255),P.updateController(t,s),o=h.updateData(o,a,e),r=g.updateData(r,o,i,a,e),h.draw(o,a,e,t),g.draw(r,t),b(t,e)}};export{Q as sketch};
