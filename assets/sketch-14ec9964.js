import{l as v,o as x,x as E,m as D,k as _,t as y,s as q,h as O,y as B,D as L,d as P,c as w}from"./tools-7018821d.js";import{p}from"./index-3a97fddc.js";class R extends v{constructor(){super(x(R.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=x(R.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(v.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(E(t in S,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,this.state==="started")){const r=this.now();this._stop(r),this._start(r)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const r=S[this._type];this._source=new D({url:r,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(r.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const b=44100*5,k=2,m={brown:null,pink:null,white:null},S={get brown(){if(!m.brown){const o=[];for(let t=0;t<k;t++){const r=new Float32Array(b);o[t]=r;let s=0;for(let e=0;e<b;e++){const n=Math.random()*2-1;r[e]=(s+.02*n)/1.02,s=r[e],r[e]*=3.5}}m.brown=new _().fromArray(o)}return m.brown},get pink(){if(!m.pink){const o=[];for(let t=0;t<k;t++){const r=new Float32Array(b);o[t]=r;let s,e,n,a,u,l,d;s=e=n=a=u=l=d=0;for(let h=0;h<b;h++){const i=Math.random()*2-1;s=.99886*s+i*.0555179,e=.99332*e+i*.0750759,n=.969*n+i*.153852,a=.8665*a+i*.3104856,u=.55*u+i*.5329522,l=-.7616*l-i*.016898,r[h]=s+e+n+a+u+l+d+i*.5362,r[h]*=.11,d=i*.115926}}m.pink=new _().fromArray(o)}return m.pink},get white(){if(!m.white){const o=[];for(let t=0;t<k;t++){const r=new Float32Array(b);o[t]=r;for(let s=0;s<b;s++)r[s]=Math.random()*2-1}m.white=new _().fromArray(o)}return m.white}},I=(o,t,r,s,e)=>{const n=e===void 0,a=(()=>{const c=r*t.circle.baseRadiusRate;if(n)return"max";if(e.status==="max")return"rotate";if(e.status==="rotate")return e.radius<0?"min":e.status;if(e.status==="min")return"back";if(e.status==="back")return e.radius>c?"max":e.status;throw`preStatus: ${e.status}`})(),u=(()=>{const c=r*t.circle.baseRadiusRate;if(n||a==="max")return c;if(a==="rotate")return e.radius-r*t.circle.radiusReducRate;if(a==="min")return 0;if(a==="back")return e.radius+r*t.circle.radiusIncreRate;throw`status: ${a}`})(),l=n?(()=>{const c=r*t.circle.centerXRate,f=r*t.circle.centerYRate;return new p.Vector(c,f)})():e.center,d=(()=>{const c=Math.random(),f=t.circle.rattlings;return c<f[0].prob?f[0].rattlingRate:c<f[1].prob?f[1].rattlingRate:c<f[2].prob?f[2].rattlingRate:1})(),h=(()=>a==="rotate"?d*(Math.PI*t.circle.bpm)/1800:0)(),i=(()=>!n&&a==="rotate"&&e.angle<Math.PI*2?e.angle+e.rotationSpeed:0)(),g=(()=>{const c=new p.Vector(Math.cos(i),Math.sin(i)),f=p.Vector.mult(c,u);return p.Vector.add(l,f)})(),V=(()=>{if(n||a==="max")return[g];if(a==="back")return e.distals;const c=t.circle.baseRadiusRate/t.circle.radiusReducRate,f=Math.floor(c/t.circle.trackArrayResolution);return s%f===0?e.distals.concat(g):e.distals})(),N=n?Math.floor(y.map(o,0,t.circle.count-1,t.circle.color.max,t.circle.color.min)):e.color;return{status:a,radius:u,center:l,rattlingRate:d,rotationSpeed:h,angle:i,distal:g,distals:V,color:N}},M=(o,t,r,s)=>s===void 0?Array.from(Array(o.circle.count),(e,n)=>I(n,o,t,r)):s.map((e,n)=>I(n,o,t,r,e)),A=(o,t,r,s)=>{const e=s===void 0,n=e?r*t.cum.distRate:s.dist,a=(()=>{const l=o.center.y+(.5-o.rattlingRate)*t.cum.rattlingSize,d=o.distal.x-Math.pow(Math.pow(n,2)-Math.pow(o.distal.y-l,2),.5);return new p.Vector(d,l)})(),u=(()=>{if(e)return[a];const l=new p.Vector(0,o.rotationSpeed*r*.3),h=s.poses.map(i=>p.Vector.add(i,l)).concat(a);return h.length<t.cum.posesLength?h:h.slice(1,h.length)})();return{dist:n,pos:a,poses:u}},F=(o,t,r,s)=>s===void 0?o.map(e=>A(e,t,r)):o.map((e,n)=>A(e,t,r,s[n])),Y=()=>({circle:{count:3,baseRadiusRate:.28,radiusReducRate:2e-4,radiusIncreRate:.005,centerXRate:.65,centerYRate:.2,bpm:30,sizeRate:.015,trackArrayResolution:85,rattlings:[{prob:.2,rattlingRate:.1},{prob:.4,rattlingRate:.3},{prob:.6,rattlingRate:.5},{prob:.8,rattlingRate:.7}],color:{min:0,max:180}},cum:{distRate:.35,posesLength:85,rattlingSize:1.5},circleOsc:[{volume:{base:-20,range:8},freq:{min:100,max:880}},{volume:{base:-25,range:7},freq:{min:80,max:220}},{volume:{base:-30,range:6},freq:{min:660,max:1600}}],cumNoise:[{volume:{min:-40,max:-20}},{volume:{min:-45,max:-25}},{volume:{min:-50,max:-30}}]}),$=(o,t)=>{const s=t.pages[1].addFolder({title:"circle"});s.addBinding(o.circle,"baseRadiusRate",{step:.1,min:.1,max:1}),s.addBinding(o.circle,"trackArrayResolution",{step:1,min:1,max:100})},T=async(o,t)=>{const r=await q(),s=o.map(()=>{const n=new O().toDestination(),a=new B().connect(n);return a.mute=!0,a.start(),{panner:n,osc:a}}),e=t.map(()=>{const n=new O().toDestination(),a=new R("pink").connect(n);return a.mute=!0,a.start(),{panner:n,noise:a}});return L.mute=!0,{se:r,circleSynths:s,cumSynths:e}},U=(o,t,r,s,e)=>{o.circleSynths.forEach((n,a)=>{n.panner.pan.value=t[a].status==="rotate"||t[a].status==="back"?y.map(t[a].distal.x,0,e,-1,1):0,n.osc.frequency.value=t[a].status==="rotate"||t[a].status==="back"?y.map(t[a].distal.y,t[a].center.y-t[a].radius,t[a].center.y+t[a].radius,s.circleOsc[a].freq.max,s.circleOsc[a].freq.min):0,n.osc.volume.value=t[a].status==="rotate"||t[a].status==="back"?s.circleOsc[a].volume.base-(1-t[a].rattlingRate)*s.circleOsc[a].volume.range:-60}),o.cumSynths.forEach((n,a)=>{n.panner.pan.value=y.map(r[a].pos.x,0,e,-1,1),n.noise.volume.value=y.map(t[0].rattlingRate,0,1,s.cumNoise[a].volume.max,s.cumNoise[a].volume.min)})},G=(o,t,r,s,e)=>{e.push(),e.fill(0),e.stroke(0),e.circle(o[0].center.x,o[0].center.y,s*r.circle.sizeRate),e.noFill(),e.circle(o[0].center.x,o[0].center.y,s*r.circle.baseRadiusRate*2),e.pop(),e.push(),e.line(0,s*r.circle.centerYRate,s,s*r.circle.centerYRate),e.pop(),o.forEach(n=>{e.push(),e.fill(n.color),e.stroke(n.color),e.circle(n.distal.x,n.distal.y,s*r.circle.sizeRate),e.noFill(),e.beginShape(),e.curveVertex(n.distals.slice(-1)[0].x,n.distals.slice(-1)[0].y),n.distals.forEach(a=>{e.curveVertex(a.x,a.y)}),e.curveVertex(n.distals[0].x,n.distals[0].y),n.distals.length>1&&e.curveVertex(n.distals[1].x,n.distals[1].y),e.endShape(),e.line(n.center.x,n.center.y,n.distal.x,n.distal.y),e.pop()}),t.forEach((n,a)=>{e.push(),e.fill(o[a].color),e.stroke(o[a].color),e.circle(n.pos.x,n.pos.y,s*r.circle.sizeRate),e.noFill(),e.beginShape(),n.poses.forEach(u=>{e.curveVertex(u.x,u.y)}),e.endShape(),e.line(o[a].distal.x,o[a].distal.y,n.pos.x,n.pos.y),e.pop()}),P(e,s)},j=o=>{const t=y.setSize("sketch");let r=w.setController();const s=Y();let e,n,a;o.setup=async()=>{e=M(s,t,0),n=F(e,s,t),a=await T(e,n),o.createCanvas(t,t);const u=w.setGui(o,r,a.se,!1);$(s,u),o.noLoop()},o.draw=()=>{if(a===void 0){o.noLoop();return}o.background(255),w.updateController(o,r),e=M(s,t,o.frameCount,e),n=F(e,s,t,n),G(e,n,s,t,o),U(a,e,n,s,t)}};export{j as sketch};
