import{s as y,D as b,d as g,t as w,c as R}from"./tools-5e3ca259.js";import{d as V}from"./debug-31bfd284.js";import{p as u}from"./index-664ba731.js";const p=(t,o,r,n)=>{const e=n===void 0,a=(()=>{const i=o*t.circle.baseRadiusRate;if(e)return"max";if(n.status==="max")return"rotate";if(n.status==="rotate")return n.radius<0?"min":n.status;if(n.status==="min")return"back";if(n.status==="back")return n.radius>i?"max":n.status;throw`preStatus: ${n.status}`})(),s=(()=>{const i=o*t.circle.baseRadiusRate;if(e||a==="max")return i;if(a==="rotate")return n.radius-o*t.circle.radiusReducRate;if(a==="min")return 0;if(a==="back")return n.radius+o*t.circle.radiusIncreRate;throw`status: ${a}`})(),d=e?(()=>{const i=o*t.circle.centerXRate,h=o*.5;return new u.Vector(i,h)})():n.center,l=(()=>a==="rotate"?(Math.random()<t.circle.rattlingProbability?.2:1)*(Math.PI*t.circle.bpm)/1800:0)(),x=(()=>!e&&a==="rotate"&&n.angle<Math.PI*2?n.angle+n.rotationSpeed:0)(),c=(()=>{const i=new u.Vector(Math.cos(x),Math.sin(x)),h=u.Vector.mult(i,s);return u.Vector.add(d,h)})(),f=(()=>{if(e||a==="max")return[c];if(a==="back")return n.distals;const i=t.circle.baseRadiusRate/t.circle.radiusReducRate,h=Math.floor(i/t.circle.trackArrayResolution);return r%h===0?n.distals.concat(c):n.distals})();return{status:a,radius:s,center:d,rotationSpeed:l,angle:x,distal:c,distals:f}},m=(t,o,r,n)=>{const e=n===void 0,a=e?r*o.cum.distRate:n.dist,s=(()=>{const l=t.center.y,x=t.distal.x-Math.pow(Math.pow(a,2)-Math.pow(t.distal.y-l,2),.5);return new u.Vector(x,l)})(),d=(()=>{if(e)return[s];const l=new u.Vector(0,t.rotationSpeed*r*.3),c=n.poses.map(f=>u.Vector.add(f,l)).concat(s);return c.length<o.cum.posesLength?c:c.slice(1,c.length)})();return{dist:a,pos:s,poses:d}},v=()=>({circle:{baseRadiusRate:.28,radiusReducRate:2e-4,radiusIncreRate:.005,centerXRate:.65,bpm:30,sizeRate:.02,trackArrayResolution:80,rattlingProbability:.3},cum:{distRate:.35,posesLength:50},maxVolume:-10}),k=(t,o)=>{const n=o.pages[1].addFolder({title:"circle"});n.addInput(t.circle,"baseRadiusRate",{step:.1,min:.1,max:1}),n.addInput(t.circle,"trackArrayResolution",{step:1,min:1,max:100}),n.addInput(t.circle,"rattlingProbability",{min:0,max:.5}),o.pages[2].addInput(t,"maxVolume",{step:1,min:-60,max:0})},S=async()=>{const t=await y();return console.log(b.get()),{se:t}},I=(t,o,r,n,e)=>{e.push(),e.fill(0),e.circle(t.distal.x,t.distal.y,n*r.circle.sizeRate),e.circle(t.center.x,t.center.y,n*r.circle.sizeRate),e.pop(),e.push(),e.noFill(),e.circle(t.center.x,t.center.y,n*r.circle.baseRadiusRate*2),e.pop(),e.push(),e.noFill(),e.beginShape(),e.curveVertex(t.distals.slice(-1)[0].x,t.distals.slice(-1)[0].y),t.distals.forEach(a=>{e.curveVertex(a.x,a.y)}),e.curveVertex(t.distals[0].x,t.distals[0].y),t.distals.length>1&&e.curveVertex(t.distals[1].x,t.distals[1].y),e.endShape(),e.line(t.center.x,t.center.y,t.distal.x,t.distal.y),e.pop(),e.push(),e.fill(0),e.circle(o.pos.x,o.pos.y,n*r.circle.sizeRate),e.pop(),e.push(),e.noFill(),e.beginShape(),o.poses.forEach(a=>{e.curveVertex(a.x,a.y)}),e.endShape(),e.pop(),e.push(),e.line(t.distal.x,t.distal.y,o.pos.x,o.pos.y),e.pop(),e.push(),e.line(0,n*.5,n,n*.5),e.pop(),g(e,n)},F=t=>{const o=w.setSize("sketch");let r=R.setController();const n=v();let e,a,s;t.setup=async()=>{s=await S(),e=p(n,o,0),a=m(e,n,o),t.createCanvas(o,o);const d=R.setGui(t,r,s.se,!1);k(n,d),t.noLoop()},t.draw=()=>{if(s===void 0){t.noLoop();return}t.frameCount%5===0&&V({lib:0},10),t.background(255),R.updateController(t,r),e=p(n,o,t.frameCount,e),a=m(e,n,o,a),I(e,a,n,o,t)}};export{F as sketch};
