import{T as k,o as d,P as V,r as W,S as M,G as b,a as lt,b as j,M as pt,e as X,f as dt,O as K,A as mt,g as ft,h as Q,i as _t,C as gt,n as tt,j as xt,k as U,l as F,m as yt,W as St,t as w,D as bt,p as it,q as wt,c as $,d as vt}from"./tools.b6fbf36d.js";import{p as m}from"./index.10952e1a.js";class P extends k{constructor(){super(d(P.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=d(P.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new V({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),W(this,"delayTime")}static getDefaults(){return Object.assign(k.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Z extends M{constructor(){super(Object.assign(d(Z.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new b({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,lt(this._constantSource,this._sum)}static getDefaults(){return Object.assign(M.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class L extends j{constructor(){super(Object.assign(d(L.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=d(L.getDefaults(),arguments,["min","max"]);this._mult=this.input=new pt({context:this.context,value:t.max-t.min}),this._add=this.output=new Z({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(j.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class H extends j{constructor(){super(Object.assign(d(H.getDefaults(),arguments))),this.name="Zero",this._gain=new b({context:this.context}),this.output=this._gain,this.input=void 0,X(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),dt(this.context.getConstant(0),this._gain),this}}class z extends k{constructor(){super(d(z.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=V.prototype._fromType,this._toType=V.prototype._toType,this._is=V.prototype._is,this._clampValue=V.prototype._clampValue;const t=d(z.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new K(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new b({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new M({context:this.context,units:"audioRange",value:0}),this._zeros=new H({context:this.context}),this._a2g=new mt({context:this.context}),this._scaler=this.output=new L({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),W(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(K.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,i=this.max;this._units=t,this.min=e,this.max=i}get state(){return this._oscillator.state}connect(t,e,i){return(t instanceof V||t instanceof M)&&(this.convert=t.convert,this.units=t.units),ft(this,t,e,i),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}class Y extends Q{constructor(){super(d(Y.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const t=d(Y.getDefaults(),arguments,["url","onload"]);this.buffer=new _t({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new gt({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(Q.getDefaults(),{onload:tt,onerror:tt,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,i){e=yt(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const n=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/n),i&&this.stop(t+this.toSeconds(i))}restart(t,e,i){return super.restart(t,e,i),this}_restart(t,e,i){this._stop(t),this._start(t,e,i)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach(e=>{e.fadeOut=0,e.stop(t)}),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),i=e*this._grainSize;if(this.log("offset",i),!this.loop&&i>this.buffer.duration){this.stop(t);return}const n=i<this._overlap?0:this._overlap,o=new xt({context:this.context,url:this.buffer,fadeIn:n,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:U(this.detune/100)}).connect(this.output);o.start(t,this._grainSize*e),o.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(o),o.onended=()=>{const r=this._activeSources.indexOf(o);r!==-1&&this._activeSources.splice(r,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){F(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&F(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&F(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);F(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach(t=>t.dispose()),this}}class At extends j{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new St({context:this.context,mapping:t=>Math.abs(t)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class C extends k{constructor(){super(Object.assign(d(C.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new At({context:this.context}),this.a=new b({context:this.context,gain:0}),this.b=new b({context:this.context,gain:0}),this.output=new b({context:this.context}),this._internalChannels=[this.a,this.b];const t=d(C.getDefaults(),arguments,["fade"]);this.fade=new M({context:this.context,units:"normalRange",value:t.fade}),W(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",X(this._split,this.a.gain,0),X(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(k.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class et extends k{constructor(t){super(t),this.name="Effect",this._dryWet=new C({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new b({context:this.context}),this.effectReturn=new b({context:this.context}),this.input=new b({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],W(this,"wet")}static getDefaults(){return Object.assign(k.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class st extends et{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new b({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,W(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(et.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class N extends st{constructor(){super(d(N.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=d(N.getDefaults(),arguments,["pitch"]);this._frequency=new M({context:this.context}),this._delayA=new P({maxDelay:1,context:this.context}),this._lfoA=new z({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new P({maxDelay:1,context:this.context}),this._lfoB=new z({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new C({context:this.context}),this._crossFadeLFO=new z({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new P({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,W(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(st.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=U(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=U(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}const nt=()=>({surfaceYPosRate:.4,g:.3,mMin:25,mMax:100,initPosMaxRate:1.2,text:"Create pockets",cd:2,rotateSpeedRate:.01,angleRangeRate:.007,fontAvatorNum:2,fontAvatorAngleGap:.4}),at=nt(),Dt=(s,t)=>{const e=t.pages[1];e.addInput(s,"surfaceYPosRate",{step:.1,min:.2,max:.8}),e.addInput(s,"g",{step:.1,min:.2,max:1.2}),e.addInput(s,"mMin",{step:1,min:5,max:20}),e.addInput(s,"mMax",{step:1,min:50,max:150}),e.addInput(s,"initPosMaxRate",{step:.1,min:.1,max:1.5}),e.addInput(s,"cd",{step:.1,min:.5,max:4})},J=(s,t)=>{const{surfaceYPosRate:e,text:i,fontAvatorNum:n,fontAvatorAngleGap:o}=s,r=i.length;return{num:r,mArray:Array.from(Array(r),()=>0),textWidthArray:Array.from(Array(r),()=>0),surfaceYPos:t*e,isReset:!0,isWaiting:!0,progressRateInWater:0,nearestXPos:0,flooders:Array.from(Array(r),(h,p)=>({isInWater:!1,isAttached:!1,m:0,v:new m.Vector().set(0,0),a:new m.Vector().set(0,0),pos:new m.Vector().set(0,0),font:i[p],isOver:!0,angles:Array.from(Array(n),(_,v)=>v*o*Math.PI)}))}};J(at,100);const Rt=(s,t,e,i)=>{const{mMin:n,mMax:o,g:r,initPosMaxRate:h,cd:p,angleRangeRate:f,rotateSpeedRate:_,fontAvatorAngleGap:v}=t,u={...s},{isReset:y,surfaceYPos:I}=s;u.mArray=(()=>y?Array.from(Array(s.num),()=>w.map(Math.random(),0,1,n,o)):s.mArray)(),u.textWidthArray=(()=>y?u.mArray.map((a,g)=>(i.textSize(a),i.textWidth(s.flooders[g].font))):s.textWidthArray)(),u.flooders=s.flooders.map((a,g)=>{const c={...a},O=()=>m.Vector.add(a.pos,c.v);return c.m=u.mArray[g],c.a=(()=>{if(a.isInWater){const R=m.Vector.mag(a.v),D=m.Vector.normalize(a.v),x=Math.pow(R,2)*p*D.y*-1/c.m;return new m.Vector().set(0,x)}return new m.Vector().set(0,0)})(),c.v=(()=>{if(y)return i.createVector(0,0);const R=m.Vector.add(i.createVector(0,r),c.a);return m.Vector.add(a.v,R)})(),c.pos=(()=>{if(y){const D=u.textWidthArray.slice(0,g).reduce((x,S)=>x+S,0),T=-1*Math.random()*h*e;return i.createVector(D,T)}return O()})(),c.angles=a.angles.map((R,D)=>{if(a.isInWater){const T=f*Math.PI*m.Vector.mag(c.v),x=T*-1,S=T,G=i.frameCount*_*c.m;if(D===0)return i.map(Math.sin(G),0,1,x,S);if(D===1)return i.map(Math.sin(G*v),0,1,x,S)}return 0}),c.isInWater=c.pos.y>I,c.isAttached=!a.isInWater&&c.isInWater,c.isOver=c.pos.y>e*(1+h)||c.pos.y<-1*h*e,c}),u.isWaiting=(()=>{for(const a of u.flooders)if(a.isInWater===!0)return!1;return!0})(),u.isReset=(()=>{for(const a of u.flooders)if(a.isOver===!1)return!1;return!0})();const l=u.flooders.map(a=>a.pos.y-I),A=(()=>u.isWaiting||u.isReset?0:l.reduce((a,g)=>a<g||g<0?a:g,e))();return u.nearestXPos=(()=>{const a=l.indexOf(A),c=u.flooders.map(O=>O.pos.x)[a];return typeof c=="number"?c:e*.5})(),u.progressRateInWater=(()=>{const a=A/(e-I);return a>1?1:a})(),u},kt=(s,t,e,i)=>{const{surfaceYPos:n}=s;i.push(),i.noStroke(),i.fill(181,141,182,40),i.rect(0,n,t,t-n),i.pop(),i.push(),i.textAlign(i.CENTER,i.BASELINE),i.textFont(e);for(const o of s.flooders){const{m:r,font:h,pos:p,isInWater:f,angles:_}=o,v=f?150:250;i.push(),i.textSize(r),i.translate(p.x,p.y),_.forEach((u,y)=>{i.push(),y===0&&i.fill(208,173,167,v),y===1&&i.fill(173,106,108,v*.4),i.rotate(u),i.text(h,0,0),i.pop()}),i.pop()}i.pop()},E={setParams:nt,setGui:Dt,setData:J,updateData:Rt,draw:kt},Tt=()=>({ampCf:.8,phaseVel:.03,cycleRate:.005,intervalRate:.005,ampRate:15e-5}),Vt=(s,t)=>{const e=t.pages[1];e.addSeparator(),e.addInput(s,"ampCf",{step:.1,min:.1,max:1}),e.addInput(s,"phaseVel",{step:.01,min:.01,max:.1}),e.addInput(s,"cycleRate",{step:.001,min:.001,max:.01}),e.addInput(s,"intervalRate",{step:.001,min:.001,max:.01}),e.addInput(s,"ampRate",{min:5e-5,max:.001})},ot=s=>{const{num:t}=s;return{bubbleLines:Array.from(Array(t),()=>({phase:0,cycle:0,interval:0,originPos:new m.Vector(0,0),num:0,amp:0,isDraw:!1,bubbles:[{pos:new m.Vector(0,0),alpha:0,size:0}]}))}},Pt=J(at,100);ot(Pt);const zt=(s,t,e,i,n)=>{const o={...t},{surfaceYPos:r,flooders:h}=s,{ampCf:p,phaseVel:f,cycleRate:_,intervalRate:v,ampRate:u}=e;return o.bubbleLines=t.bubbleLines.map((y,I)=>{const l={...y},A=h[I];if(l.cycle=i*A.m*_,l.interval=l.cycle*A.m*v,l.originPos=A.pos,l.num=Math.floor((l.originPos.y-r)/l.interval),l.amp=i*A.m*u,l.phase=y.phase+f,l.isDraw=l.num>1,!l.isDraw)return l;const{originPos:a,num:g,cycle:c,interval:O,amp:R,phase:D}=l;return l.bubbles=Array.from(Array(g),(T,x)=>{const S=(()=>{const G=x*O+r,ct=G*2*Math.PI/c+D,ht=R*Math.pow(x,p),ut=Math.sin(ct)*ht+a.x;return n.createVector(ut,G)})();return{pos:S,alpha:n.noise(S.x,S.y)*x*10,size:n.noise(S.x,S.y)*Math.pow(x,.3)*A.m*.15}}),l}),o},Mt=(s,t)=>{t.push(),t.noStroke();for(const e of s.bubbleLines){const{bubbles:i,isDraw:n}=e;n&&i.forEach((o,r)=>{const{pos:h,alpha:p,size:f}=o;t.fill(208,173,167,p),r!=0&&t.circle(h.x,h.y,f)})}t.pop()},q={setParams:Tt,setGui:Vt,setData:ot,updateData:zt,draw:Mt},Wt="/playground/assets/toggle_on.bf4c5ffc.wav",It="/playground/assets/toggle_off.97d6cba3.wav",Ot=()=>({maxVolume:-15,minVolume:-40,grainMaxVolume:-23,minPitch:-20,maxPitch:20}),Gt=(s,t)=>{t.pages[2].addInput(s,"maxVolume",{step:1,min:-60,max:0})},Et=()=>{const s=new it(.5).toDestination(),t=new N().connect(s),e=new wt({urls:{A1:Wt,A2:It}}).connect(t);return{panner:s,pitchShift:t,instrument:e}},qt=()=>{const s=new it(.5).toDestination(),t=new Y({url:"../src/20220627/sound/toggle_off.wav",loop:!0,grainSize:.06,overlap:.1,playbackRate:2.5,onload:()=>{t.volume.value=-60,t.connect(s),t.start()}});return{panner:s,source:t}},rt=()=>{const s=Et(),t=qt();return bt.mute=!0,{tapSampler:s,grainPlayer:t}};rt();const Ct=(s,t,e,i,n)=>{s.flooders.forEach((o,r)=>{if(o.isAttached){const h=w.constrain(w.map(o.pos.x,0,n,-1,1),-1,1),p=w.map(o.m,t.mMin,t.mMax,e.maxVolume,e.minVolume),f=w.map(t.mMax-o.m,t.mMin,t.mMax,e.minPitch,e.maxPitch),_=r%2===0?"A1":"A2";i.tapSampler.panner.pan.value=h,i.tapSampler.pitchShift.pitch=f,i.tapSampler.instrument.volume.value=p,i.tapSampler.instrument.triggerAttackRelease(_,.1)}})},Ft=(s,t,e,i)=>{const{progressRateInWater:n,nearestXPos:o}=s,r=w.map(1-n,0,1,-35,t.grainMaxVolume),h=w.constrain(w.map(o,0,i,-1,1),-1,1);n===0?e.grainPlayer.source.mute=!0:(e.grainPlayer.source.volume.value=r,e.grainPlayer.panner.pan.value=h)},Bt=(s,t,e,i,n)=>{Ct(s,t,e,i,n),Ft(s,e,i,n)},B={setParams:Ot,setGui:Gt,setSynth:rt,playSynth:Bt},jt="/playground/assets/Fascinate-Regular.5a20fb9b.ttf",Nt=async s=>{const t=w.setSize("sketch");let e,i=$.setController();const n=E.setParams(),o=q.setParams(),r=B.setParams();let h=E.setData(n,t),p=q.setData(h),f=B.setSynth();s.preload=()=>{e=s.loadFont(jt)},s.setup=()=>{s.createCanvas(t,t);const _=$.setGui(s,i,!0,!1);E.setGui(n,_),q.setGui(o,_),B.setGui(r,_),s.noLoop()},s.draw=()=>{s.background(255),$.updateController(s,i),h=E.updateData(h,n,t,s),p=q.updateData(h,p,o,t,s),E.draw(h,t,e,s),q.draw(p,s),vt(s,t),B.playSynth(h,n,r,f,t)}};export{Nt as sketch};
