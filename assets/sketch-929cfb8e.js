import{S as F,o as v,G as C,a as it,b as L,M as ot,e as rt,f as ct,T as lt,P as T,O as $,A as ut,r as Z,g as ht,i as N,t as w,s as pt,D as mt,h as H,j as dt,c as k,d as X}from"./tools-3de08622.js";import{p as d}from"./index-2134a18a.js";import{F as U,D as I}from"./FeedbackEffect-e7fc4280.js";import{C as ft}from"./CrossFade-528f52e5.js";import{G as _t}from"./GrainPlayer-7a750b6a.js";import"./Effect-9745131a.js";class j extends F{constructor(){super(Object.assign(v(j.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new C({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,it(this._constantSource,this._sum)}static getDefaults(){return Object.assign(F.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class z extends L{constructor(){super(Object.assign(v(z.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=v(z.getDefaults(),arguments,["min","max"]);this._mult=this.input=new ot({context:this.context,value:t.max-t.min}),this._add=this.output=new j({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(L.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Y extends L{constructor(){super(Object.assign(v(Y.getDefaults(),arguments))),this.name="Zero",this._gain=new C({context:this.context}),this.output=this._gain,this.input=void 0,rt(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),ct(this.context.getConstant(0),this._gain),this}}class R extends lt{constructor(){super(v(R.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=T.prototype._fromType,this._toType=T.prototype._toType,this._is=T.prototype._is,this._clampValue=T.prototype._clampValue;const t=v(R.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new $(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new C({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new F({context:this.context,units:"audioRange",value:0}),this._zeros=new Y({context:this.context}),this._a2g=new ut({context:this.context}),this._scaler=this.output=new z({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Z(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign($.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const s=this.min,a=this.max;this._units=t,this.min=s,this.max=a}get state(){return this._oscillator.state}connect(t,s,a){return(t instanceof T||t instanceof F)&&(this.convert=t.convert,this.units=t.units),ht(this,t,s,a),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}class q extends U{constructor(){super(v(q.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=v(q.getDefaults(),arguments,["pitch"]);this._frequency=new F({context:this.context}),this._delayA=new I({maxDelay:1,context:this.context}),this._lfoA=new R({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new I({maxDelay:1,context:this.context}),this._lfoB=new R({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new ft({context:this.context}),this._crossFadeLFO=new R({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new I({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,Z(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const s=this.now();this._lfoA.start(s),this._lfoB.start(s),this._crossFadeLFO.start(s),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(U.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let s=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,s=N(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,s=N(t)-1),this._frequency.value=s*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}const J=()=>({surfaceYPosRate:.4,g:.3,mMin:25,mMax:100,initPosMaxRate:1.2,text:"Create pockets",cd:2,rotateSpeedRate:.01,angleRangeRate:.007,fontAvatorNum:2,fontAvatorAngleGap:.4}),K=J(),gt=(e,t)=>{const s=t.pages[1];s.addBinding(e,"surfaceYPosRate",{step:.1,min:.2,max:.8}),s.addBinding(e,"g",{step:.1,min:.2,max:1.2}),s.addBinding(e,"mMin",{step:1,min:5,max:20}),s.addBinding(e,"mMax",{step:1,min:50,max:150}),s.addBinding(e,"initPosMaxRate",{step:.1,min:.1,max:1.5}),s.addBinding(e,"cd",{step:.1,min:.5,max:4})},E=(e,t)=>{const{surfaceYPosRate:s,text:a,fontAvatorNum:i,fontAvatorAngleGap:l}=e,u=a.length;return{num:u,mArray:Array.from(Array(u),()=>0),textWidthArray:Array.from(Array(u),()=>0),surfaceYPos:t*s,isReset:!0,isWaiting:!0,progressRateInWater:0,nearestXPos:0,flooders:Array.from(Array(u),(r,p)=>({isInWater:!1,isAttached:!1,m:0,v:new d.Vector().set(0,0),a:new d.Vector().set(0,0),pos:new d.Vector().set(0,0),font:a[p],isOver:!0,angles:Array.from(Array(i),(f,A)=>A*l*Math.PI)}))}};E(K,100);const yt=(e,t,s,a)=>{const{mMin:i,mMax:l,g:u,initPosMaxRate:r,cd:p,angleRangeRate:m,rotateSpeedRate:f,fontAvatorAngleGap:A}=t,c={...e},{isReset:y,surfaceYPos:V}=e;c.mArray=(()=>y?Array.from(Array(e.num),()=>w.map(Math.random(),0,1,i,l)):e.mArray)(),c.textWidthArray=(()=>y?c.mArray.map((n,_)=>(a.textSize(n),a.textWidth(e.flooders[_].font))):e.textWidthArray)(),c.flooders=e.flooders.map((n,_)=>{const o={...n},M=()=>d.Vector.add(n.pos,o.v);return o.m=c.mArray[_],o.a=(()=>{if(n.isInWater){const D=d.Vector.mag(n.v),b=d.Vector.normalize(n.v),g=Math.pow(D,2)*p*b.y*-1/o.m;return new d.Vector().set(0,g)}return new d.Vector().set(0,0)})(),o.v=(()=>{if(y)return a.createVector(0,0);const D=d.Vector.add(a.createVector(0,u),o.a);return d.Vector.add(n.v,D)})(),o.pos=(()=>{if(y){const b=c.textWidthArray.slice(0,_).reduce((g,x)=>g+x,0),P=-1*Math.random()*r*s;return a.createVector(b,P)}return M()})(),o.angles=n.angles.map((D,b)=>{if(n.isInWater){const P=m*Math.PI*d.Vector.mag(o.v),g=P*-1,x=P,B=a.frameCount*f*o.m;if(b===0)return a.map(Math.sin(B),0,1,g,x);if(b===1)return a.map(Math.sin(B*A),0,1,g,x)}return 0}),o.isInWater=o.pos.y>V,o.isAttached=!n.isInWater&&o.isInWater,o.isOver=o.pos.y>s*(1+r)||o.pos.y<-1*r*s,o}),c.isWaiting=(()=>{for(const n of c.flooders)if(n.isInWater===!0)return!1;return!0})(),c.isReset=(()=>{for(const n of c.flooders)if(n.isOver===!1)return!1;return!0})();const h=c.flooders.map(n=>n.pos.y-V),S=(()=>c.isWaiting||c.isReset?0:h.reduce((n,_)=>n<_||_<0?n:_,s))();return c.nearestXPos=(()=>{const n=h.indexOf(S),o=c.flooders.map(M=>M.pos.x)[n];return typeof o=="number"?o:s*.5})(),c.progressRateInWater=(()=>{const n=S/(s-V);return n>1?1:n})(),c},xt=(e,t,s,a)=>{const{surfaceYPos:i}=e;a.push(),a.noStroke(),a.fill(181,141,182,40),a.rect(0,i,t,t-i),a.pop(),a.push(),a.textAlign(a.CENTER,a.BASELINE),a.textFont(s);for(const l of e.flooders){const{m:u,font:r,pos:p,isInWater:m,angles:f}=l,A=m?150:250;a.push(),a.textSize(u),a.translate(p.x,p.y),f.forEach((c,y)=>{a.push(),y===0&&a.fill(208,173,167,A),y===1&&a.fill(173,106,108,A*.4),a.rotate(c),a.text(r,0,0),a.pop()}),a.pop()}a.pop()},G={setParams:J,setGui:gt,setData:E,updateData:yt,draw:xt},wt=()=>({ampCf:.8,phaseVel:.03,cycleRate:.005,intervalRate:.005,ampRate:15e-5}),At=(e,t)=>{const s=t.pages[1];s.addBlade({view:"separator"}),s.addBinding(e,"ampCf",{step:.1,min:.1,max:1}),s.addBinding(e,"phaseVel",{step:.01,min:.01,max:.1}),s.addBinding(e,"cycleRate",{step:.001,min:.001,max:.01}),s.addBinding(e,"intervalRate",{step:.001,min:.001,max:.01}),s.addBinding(e,"ampRate",{min:5e-5,max:.001})},Q=e=>{const{num:t}=e;return{bubbleLines:Array.from(Array(t),()=>({phase:0,cycle:0,interval:0,originPos:new d.Vector(0,0),num:0,amp:0,isDraw:!1,bubbles:[{pos:new d.Vector(0,0),alpha:0,size:0}]}))}},St=E(K,100);Q(St);const bt=(e,t,s,a,i)=>{const l={...t},{surfaceYPos:u,flooders:r}=e,{ampCf:p,phaseVel:m,cycleRate:f,intervalRate:A,ampRate:c}=s;return l.bubbleLines=t.bubbleLines.map((y,V)=>{const h={...y},S=r[V];if(h.cycle=a*S.m*f,h.interval=h.cycle*S.m*A,h.originPos=S.pos,h.num=Math.floor((h.originPos.y-u)/h.interval),h.amp=a*S.m*c,h.phase=y.phase+m,h.isDraw=h.num>1,!h.isDraw)return h;const{originPos:n,num:_,cycle:o,interval:M,amp:D,phase:b}=h;return h.bubbles=Array.from(Array(_),(P,g)=>{const x=(()=>{const B=g*M+u,st=B*2*Math.PI/o+b,at=D*Math.pow(g,p),nt=Math.sin(st)*at+n.x;return i.createVector(nt,B)})();return{pos:x,alpha:i.noise(x.x,x.y)*g*10,size:i.noise(x.x,x.y)*Math.pow(g,.3)*S.m*.15}}),h}),l},vt=(e,t)=>{t.push(),t.noStroke();for(const s of e.bubbleLines){const{bubbles:a,isDraw:i}=s;i&&a.forEach((l,u)=>{const{pos:r,alpha:p,size:m}=l;t.fill(208,173,167,p),u!=0&&t.circle(r.x,r.y,m)})}t.pop()},W={setParams:wt,setGui:At,setData:Q,updateData:bt,draw:vt},Dt="/playground/assets/toggle_on-bf4c5ffc.wav",tt="/playground/assets/toggle_off-97d6cba3.wav",Pt=()=>({maxVolume:-15,minVolume:-40,grainMaxVolume:-23,minPitch:-20,maxPitch:20}),Rt=(e,t)=>{t.pages[2].addBinding(e,"maxVolume",{step:1,min:-60,max:0})},Vt=()=>{const e=new H(.5).toDestination(),t=new q().connect(e),s=new dt({urls:{A1:Dt,A2:tt}}).connect(t);return{panner:e,pitchShift:t,instrument:s}},Mt=()=>{const e=new H(.5).toDestination(),t=new _t({url:tt,loop:!0,grainSize:.06,overlap:.1,playbackRate:2.5,onload:()=>{t.volume.value=-60,t.connect(e),t.start()}});return{panner:e,source:t}},et=async()=>{const e=Vt(),t=Mt(),s=await pt();return mt.mute=!0,{tapSampler:e,grainPlayer:t,se:s}};await et();const Bt=(e,t,s,a,i)=>{e.flooders.forEach((l,u)=>{if(l.isAttached){const r=w.constrain(w.map(l.pos.x,0,i,-1,1),-1,1),p=w.map(l.m,t.mMin,t.mMax,s.maxVolume,s.minVolume),m=w.map(t.mMax-l.m,t.mMin,t.mMax,s.minPitch,s.maxPitch),f=u%2===0?"A1":"A2";a.tapSampler.panner.pan.value=r,a.tapSampler.pitchShift.pitch=m,a.tapSampler.instrument.volume.value=p,a.tapSampler.instrument.triggerAttackRelease(f,.1)}})},Tt=(e,t,s,a)=>{const{progressRateInWater:i,nearestXPos:l}=e,u=w.map(1-i,0,1,-35,t.grainMaxVolume),r=w.constrain(w.map(l,0,a,-1,1),-1,1);i===0?s.grainPlayer.source.mute=!0:(s.grainPlayer.source.volume.value=u,s.grainPlayer.panner.pan.value=r)},Gt=(e,t,s,a,i)=>{Bt(e,t,s,a,i),Tt(e,s,a,i)},O={setParams:Pt,setGui:Rt,setSynth:et,playSynth:Gt},Wt="/playground/assets/Fascinate-Regular-5a20fb9b.ttf",Lt=async e=>{const t=w.setSize("sketch");let s,a=k.setController();const i=G.setParams(),l=W.setParams(),u=O.setParams();let r=G.setData(i,t),p=W.setData(r),m;e.preload=()=>{s=e.loadFont(Wt)},e.setup=async()=>{e.createCanvas(t,t),m=await O.setSynth();const f=k.setGui(e,a,m.se,!1);G.setGui(i,f),W.setGui(l,f),O.setGui(u,f),e.noLoop(),X(e,t)},e.draw=()=>{m===void 0&&e.noLoop(),e.background(255),k.updateController(e,a),r=G.updateData(r,i,t,e),p=W.updateData(r,p,l,t,e),G.draw(r,t,s,e),W.draw(p,e),X(e,t),O.playSynth(r,i,u,m,t)}};export{Lt as sketch};
