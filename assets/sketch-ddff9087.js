import{s as b,I as F,D as U,t as h,O as k,d as q,c as y}from"./tools-799dad41.js";import{p as u}from"./index-1b8ea48e.js";import{F as S}from"./Freeverb-0dc108b9.js";import"./CrossFade-65eb7e5b.js";import"./Split-f7cd51cf.js";const _=(e,t,s)=>{if(s!=null&&t.isUpdate==!1)return s;const n=e.length===0?{dividend:t.euclid.dividend,divisor:t.euclid.divisor}:e.slice(-1)[0];e.length===0&&e.push(n);const o=e.length>t.euclid.thr;if(n.divisor===0||o)return e;const d=n.dividend%n.divisor,i={dividend:n.divisor,divisor:d};return e.push(i),_(e,t)},g=(e,t,s,n)=>{if(n!=null&&t.isUpdate===!1)return n;const o=(()=>{const c=e[0].divisor,a=e[1].divisor,l=Math.floor(e[0].dividend/e[0].divisor);return{x:e[1]===void 0?c:c*l+a,y:c}})(),d=new u.Vector(s/o.x,s/o.y),i=e.map((c,a)=>a%2===0?"x":"y"),r=e.map(c=>{if(c.divisor===0)return[new u.Vector(0,0)];const a=Math.floor(c.dividend/c.divisor);return Array.from(Array(a),()=>u.Vector.mult(d,c.divisor))}),m=r.map((c,a)=>c.map(l=>i[a]==="x"?new u.Vector(l.x,0):new u.Vector(0,l.y))).flat().map((c,a,l)=>a===0?new u.Vector(0,0):l.slice(0,a).reduce((v,f)=>u.Vector.add(v,f))),x=r.map((c,a)=>{const l=a/r.length;return c.map((v,f)=>{const I=r[0][0]===void 0?1:v.x*v.y/(r[0][0].x*r[0][0].y),w=f/c.length;return{area:I,pairIndex:l,rectIndex:w}})}).flat();return{sizes:r.flat(),positions:m,rates:x}},V=()=>({euclid:{dividend:37,divisor:27,thr:10},rect:{h_min:190,h_max:220,s_min:15,s_max:35,b_min:40,b_max:80},synth:{count:15,baseFreq:1e3,volume_min:-25,volume_max:-5},env:{attack:.1,decay:.2,sustain:.8,release:.8},isUpdate:!1}),z=e=>{e.isUpdate===!0&&(e.isUpdate=!1)},A=(e,t)=>{const s=t.pages[1],n=s.addFolder({title:"euclid"});n.addInput(e.euclid,"dividend",{step:1,min:2,max:1e3}).on("change",()=>e.isUpdate=!0),n.addInput(e.euclid,"divisor",{step:1,min:2,max:1e3}).on("change",()=>e.isUpdate=!0),n.addInput(e.euclid,"thr",{step:1,min:2,max:20}),n.addMonitor(e,"isUpdate");const o=s.addFolder({title:"rect"});o.addInput(e.rect,"h_min",{step:1,min:0,max:255}),o.addInput(e.rect,"h_max",{step:1,min:0,max:255}),o.addInput(e.rect,"s_min",{step:1,min:0,max:255}),o.addInput(e.rect,"s_max",{step:1,min:0,max:255}),o.addInput(e.rect,"b_min",{step:1,min:0,max:255}),o.addInput(e.rect,"b_max",{step:1,min:0,max:255});const d=t.pages[2],i=d.addFolder({title:"synth"});i.addInput(e.synth,"baseFreq",{step:1,min:100,max:2e3}),i.addInput(e.synth,"volume_min",{step:1,min:-60,max:-20}),i.addInput(e.synth,"volume_max",{step:1,min:-20,max:-5});const r=d.addFolder({title:"env"});r.addInput(e.env,"attack",{min:.1,max:.9}),r.addInput(e.env,"decay",{min:.1,max:.9}),r.addInput(e.env,"sustain",{min:.1,max:.9}),r.addInput(e.env,"release",{min:.1,max:.9})},C=e=>{const t=new k(440,"sine").connect(e);return t.mute=!0,t.start(),t},M=async e=>{const t=await b(),s=new S(.4,e.synth.baseFreq).toDestination(),n=new F(e.env).connect(s),o=Array.from(Array(e.synth.count),()=>C(n));return console.log(U.get()),{se:t,env:n,oscillators:o}},R=(e,t,s)=>{if(s.isUpdate===!1)return;e.env.triggerRelease(),e.env.triggerAttack(s.env.release);const n=t.sizes.length>s.synth.count?s.synth.count:t.sizes.length,o=t.rates.map(i=>s.synth.baseFreq*i.pairIndex*i.rectIndex),d=t.rates.map(i=>h.map(i.area/n,0,1,s.synth.volume_min,s.synth.volume_max));e.oscillators.forEach((i,r)=>{if(r>t.sizes.length-1)return;const p=o[r],m=d[r];i.frequency.value=p,i.volume.value=m})},D=(e,t,s,n)=>{n.push(),n.noStroke(),e.sizes.forEach((o,d)=>{const i=e.positions[d],r=e.rates[d],p=h.map(r.area,0,1,t.rect.h_min,t.rect.h_max),m=h.map(r.pairIndex,0,1,t.rect.s_max,t.rect.s_min),x=h.map(r.rectIndex,0,1,t.rect.b_min,t.rect.b_max);n.fill(p,m,x),n.rect(i.x,i.y,o.x,o.y)}),n.pop(),q(n,s)},G=e=>{const t=h.setSize("sketch");let s=y.setController();const n=V();let o,d,i;e.setup=async()=>{i=await M(n),o=_([],n),d=g(o,n,t),e.createCanvas(t,t);const r=y.setGui(e,s,i.se,!1);A(n,r),e.colorMode(e.HSB),e.noLoop()},e.draw=()=>{if(i===void 0){e.noLoop();return}e.background(255),y.updateController(e,s),o=_([],n,o),d=g(o,n,t,d),D(d,n,t,e),e.frameCount>1&&R(i,d,n),z(n)}};export{G as sketch};
