import{T as j,o as w,P as V,r as B,S as O,G as L,a as rt,b as E,M as ct,e as lt,f as ut,O as X,A as ht,g as pt,i as U,t as b,s as mt,D as dt,h as K,j as ft,c as C,d as Z}from"./tools.8ba16a64.js";import{p as d}from"./index.0d3abd3b.js";import{E as H,C as _t}from"./Effect.89bba44d.js";import{G as yt}from"./GrainPlayer.20444e4a.js";class P extends j{constructor(){super(w(P.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=w(P.getDefaults(),arguments,["delayTime","maxDelay"]),s=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(s,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(s),this.delayTime=new V({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),B(this,"delayTime")}static getDefaults(){return Object.assign(j.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Y extends O{constructor(){super(Object.assign(w(Y.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new L({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,rt(this._constantSource,this._sum)}static getDefaults(){return Object.assign(O.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class z extends E{constructor(){super(Object.assign(w(z.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=w(z.getDefaults(),arguments,["min","max"]);this._mult=this.input=new ct({context:this.context,value:t.max-t.min}),this._add=this.output=new Y({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(E.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class N extends E{constructor(){super(Object.assign(w(N.getDefaults(),arguments))),this.name="Zero",this._gain=new L({context:this.context}),this.output=this._gain,this.input=void 0,lt(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),ut(this.context.getConstant(0),this._gain),this}}class T extends j{constructor(){super(w(T.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=V.prototype._fromType,this._toType=V.prototype._toType,this._is=V.prototype._is,this._clampValue=V.prototype._clampValue;const t=w(T.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new X(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new L({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new O({context:this.context,units:"audioRange",value:0}),this._zeros=new N({context:this.context}),this._a2g=new ht({context:this.context}),this._scaler=this.output=new z({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),B(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(X.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const s=this.min,a=this.max;this._units=t,this.min=s,this.max=a}get state(){return this._oscillator.state}connect(t,s,a){return(t instanceof V||t instanceof O)&&(this.convert=t.convert,this.units=t.units),pt(this,t,s,a),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}class J extends H{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new L({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,B(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(H.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class q extends J{constructor(){super(w(q.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=w(q.getDefaults(),arguments,["pitch"]);this._frequency=new O({context:this.context}),this._delayA=new P({maxDelay:1,context:this.context}),this._lfoA=new T({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new P({maxDelay:1,context:this.context}),this._lfoB=new T({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new _t({context:this.context}),this._crossFadeLFO=new T({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new P({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,B(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const s=this.now();this._lfoA.start(s),this._lfoB.start(s),this._crossFadeLFO.start(s),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(J.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let s=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,s=U(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,s=U(t)-1),this._frequency.value=s*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}const Q=()=>({surfaceYPosRate:.4,g:.3,mMin:25,mMax:100,initPosMaxRate:1.2,text:"Create pockets",cd:2,rotateSpeedRate:.01,angleRangeRate:.007,fontAvatorNum:2,fontAvatorAngleGap:.4}),tt=Q(),gt=(e,t)=>{const s=t.pages[1];s.addInput(e,"surfaceYPosRate",{step:.1,min:.2,max:.8}),s.addInput(e,"g",{step:.1,min:.2,max:1.2}),s.addInput(e,"mMin",{step:1,min:5,max:20}),s.addInput(e,"mMax",{step:1,min:50,max:150}),s.addInput(e,"initPosMaxRate",{step:.1,min:.1,max:1.5}),s.addInput(e,"cd",{step:.1,min:.5,max:4})},$=(e,t)=>{const{surfaceYPosRate:s,text:a,fontAvatorNum:i,fontAvatorAngleGap:l}=e,u=a.length;return{num:u,mArray:Array.from(Array(u),()=>0),textWidthArray:Array.from(Array(u),()=>0),surfaceYPos:t*s,isReset:!0,isWaiting:!0,progressRateInWater:0,nearestXPos:0,flooders:Array.from(Array(u),(r,p)=>({isInWater:!1,isAttached:!1,m:0,v:new d.Vector().set(0,0),a:new d.Vector().set(0,0),pos:new d.Vector().set(0,0),font:a[p],isOver:!0,angles:Array.from(Array(i),(f,S)=>S*l*Math.PI)}))}};$(tt,100);const xt=(e,t,s,a)=>{const{mMin:i,mMax:l,g:u,initPosMaxRate:r,cd:p,angleRangeRate:m,rotateSpeedRate:f,fontAvatorAngleGap:S}=t,c={...e},{isReset:g,surfaceYPos:M}=e;c.mArray=(()=>g?Array.from(Array(e.num),()=>b.map(Math.random(),0,1,i,l)):e.mArray)(),c.textWidthArray=(()=>g?c.mArray.map((n,_)=>(a.textSize(n),a.textWidth(e.flooders[_].font))):e.textWidthArray)(),c.flooders=e.flooders.map((n,_)=>{const o={...n},G=()=>d.Vector.add(n.pos,o.v);return o.m=c.mArray[_],o.a=(()=>{if(n.isInWater){const v=d.Vector.mag(n.v),D=d.Vector.normalize(n.v),y=Math.pow(v,2)*p*D.y*-1/o.m;return new d.Vector().set(0,y)}return new d.Vector().set(0,0)})(),o.v=(()=>{if(g)return a.createVector(0,0);const v=d.Vector.add(a.createVector(0,u),o.a);return d.Vector.add(n.v,v)})(),o.pos=(()=>{if(g){const D=c.textWidthArray.slice(0,_).reduce((y,x)=>y+x,0),R=-1*Math.random()*r*s;return a.createVector(D,R)}return G()})(),o.angles=n.angles.map((v,D)=>{if(n.isInWater){const R=m*Math.PI*d.Vector.mag(o.v),y=R*-1,x=R,I=a.frameCount*f*o.m;if(D===0)return a.map(Math.sin(I),0,1,y,x);if(D===1)return a.map(Math.sin(I*S),0,1,y,x)}return 0}),o.isInWater=o.pos.y>M,o.isAttached=!n.isInWater&&o.isInWater,o.isOver=o.pos.y>s*(1+r)||o.pos.y<-1*r*s,o}),c.isWaiting=(()=>{for(const n of c.flooders)if(n.isInWater===!0)return!1;return!0})(),c.isReset=(()=>{for(const n of c.flooders)if(n.isOver===!1)return!1;return!0})();const h=c.flooders.map(n=>n.pos.y-M),A=(()=>c.isWaiting||c.isReset?0:h.reduce((n,_)=>n<_||_<0?n:_,s))();return c.nearestXPos=(()=>{const n=h.indexOf(A),o=c.flooders.map(G=>G.pos.x)[n];return typeof o=="number"?o:s*.5})(),c.progressRateInWater=(()=>{const n=A/(s-M);return n>1?1:n})(),c},wt=(e,t,s,a)=>{const{surfaceYPos:i}=e;a.push(),a.noStroke(),a.fill(181,141,182,40),a.rect(0,i,t,t-i),a.pop(),a.push(),a.textAlign(a.CENTER,a.BASELINE),a.textFont(s);for(const l of e.flooders){const{m:u,font:r,pos:p,isInWater:m,angles:f}=l,S=m?150:250;a.push(),a.textSize(u),a.translate(p.x,p.y),f.forEach((c,g)=>{a.push(),g===0&&a.fill(208,173,167,S),g===1&&a.fill(173,106,108,S*.4),a.rotate(c),a.text(r,0,0),a.pop()}),a.pop()}a.pop()},k={setParams:Q,setGui:gt,setData:$,updateData:xt,draw:wt},bt=()=>({ampCf:.8,phaseVel:.03,cycleRate:.005,intervalRate:.005,ampRate:15e-5}),St=(e,t)=>{const s=t.pages[1];s.addSeparator(),s.addInput(e,"ampCf",{step:.1,min:.1,max:1}),s.addInput(e,"phaseVel",{step:.01,min:.01,max:.1}),s.addInput(e,"cycleRate",{step:.001,min:.001,max:.01}),s.addInput(e,"intervalRate",{step:.001,min:.001,max:.01}),s.addInput(e,"ampRate",{min:5e-5,max:.001})},et=e=>{const{num:t}=e;return{bubbleLines:Array.from(Array(t),()=>({phase:0,cycle:0,interval:0,originPos:new d.Vector(0,0),num:0,amp:0,isDraw:!1,bubbles:[{pos:new d.Vector(0,0),alpha:0,size:0}]}))}},At=$(tt,100);et(At);const Dt=(e,t,s,a,i)=>{const l={...t},{surfaceYPos:u,flooders:r}=e,{ampCf:p,phaseVel:m,cycleRate:f,intervalRate:S,ampRate:c}=s;return l.bubbleLines=t.bubbleLines.map((g,M)=>{const h={...g},A=r[M];if(h.cycle=a*A.m*f,h.interval=h.cycle*A.m*S,h.originPos=A.pos,h.num=Math.floor((h.originPos.y-u)/h.interval),h.amp=a*A.m*c,h.phase=g.phase+m,h.isDraw=h.num>1,!h.isDraw)return h;const{originPos:n,num:_,cycle:o,interval:G,amp:v,phase:D}=h;return h.bubbles=Array.from(Array(_),(R,y)=>{const x=(()=>{const I=y*G+u,nt=I*2*Math.PI/o+D,it=v*Math.pow(y,p),ot=Math.sin(nt)*it+n.x;return i.createVector(ot,I)})();return{pos:x,alpha:i.noise(x.x,x.y)*y*10,size:i.noise(x.x,x.y)*Math.pow(y,.3)*A.m*.15}}),h}),l},vt=(e,t)=>{t.push(),t.noStroke();for(const s of e.bubbleLines){const{bubbles:a,isDraw:i}=s;i&&a.forEach((l,u)=>{const{pos:r,alpha:p,size:m}=l;t.fill(208,173,167,p),u!=0&&t.circle(r.x,r.y,m)})}t.pop()},W={setParams:bt,setGui:St,setData:et,updateData:Dt,draw:vt},Rt="/playground/assets/toggle_on.bf4c5ffc.wav",st="/playground/assets/toggle_off.97d6cba3.wav",Vt=()=>({maxVolume:-15,minVolume:-40,grainMaxVolume:-23,minPitch:-20,maxPitch:20}),Pt=(e,t)=>{t.pages[2].addInput(e,"maxVolume",{step:1,min:-60,max:0})},Tt=()=>{const e=new K(.5).toDestination(),t=new q().connect(e),s=new ft({urls:{A1:Rt,A2:st}}).connect(t);return{panner:e,pitchShift:t,instrument:s}},Mt=()=>{const e=new K(.5).toDestination(),t=new yt({url:st,loop:!0,grainSize:.06,overlap:.1,playbackRate:2.5,onload:()=>{t.volume.value=-60,t.connect(e),t.start()}});return{panner:e,source:t}},at=async()=>{const e=Tt(),t=Mt(),s=await mt();return dt.mute=!0,{tapSampler:e,grainPlayer:t,se:s}};await at();const Gt=(e,t,s,a,i)=>{e.flooders.forEach((l,u)=>{if(l.isAttached){const r=b.constrain(b.map(l.pos.x,0,i,-1,1),-1,1),p=b.map(l.m,t.mMin,t.mMax,s.maxVolume,s.minVolume),m=b.map(t.mMax-l.m,t.mMin,t.mMax,s.minPitch,s.maxPitch),f=u%2===0?"A1":"A2";a.tapSampler.panner.pan.value=r,a.tapSampler.pitchShift.pitch=m,a.tapSampler.instrument.volume.value=p,a.tapSampler.instrument.triggerAttackRelease(f,.1)}})},It=(e,t,s,a)=>{const{progressRateInWater:i,nearestXPos:l}=e,u=b.map(1-i,0,1,-35,t.grainMaxVolume),r=b.constrain(b.map(l,0,a,-1,1),-1,1);i===0?s.grainPlayer.source.mute=!0:(s.grainPlayer.source.volume.value=u,s.grainPlayer.panner.pan.value=r)},kt=(e,t,s,a,i)=>{Gt(e,t,s,a,i),It(e,s,a,i)},F={setParams:Vt,setGui:Pt,setSynth:at,playSynth:kt},Wt="/playground/assets/Fascinate-Regular.5a20fb9b.ttf",Bt=async e=>{const t=b.setSize("sketch");let s,a=C.setController();const i=k.setParams(),l=W.setParams(),u=F.setParams();let r=k.setData(i,t),p=W.setData(r),m;e.preload=()=>{s=e.loadFont(Wt)},e.setup=async()=>{e.createCanvas(t,t),m=await F.setSynth();const f=C.setGui(e,a,m.se,!1);k.setGui(i,f),W.setGui(l,f),F.setGui(u,f),e.noLoop(),Z(e,t)},e.draw=()=>{m===void 0&&e.noLoop(),e.background(255),C.updateController(e,a),r=k.updateData(r,i,t,e),p=W.updateData(r,p,l,t,e),k.draw(r,t,s,e),W.draw(p,e),Z(e,t),F.playSynth(r,i,u,m,t)}};export{Bt as sketch};
