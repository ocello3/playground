import{o as V,r as D,t as m,s as B,h as Q,j as b,z as T,d as W,c as p}from"./tools-c504d83d.js";import{d as v}from"./debug-af332fa9.js";import{p as l}from"./index-0bdef767.js";import{F as E,D as G}from"./FeedbackEffect-a997cc27.js";import"./Effect-3276dc45.js";import"./CrossFade-799bb00a.js";class g extends E{constructor(){super(V(g.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const t=V(g.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new G({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),D(this,"delayTime")}static getDefaults(){return Object.assign(E.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}const M=(a,t)=>{const n=t===void 0,e=n?"init":t.status,s=(()=>{if(n)return"init";switch(t.status){case"init":return"waiting";case"waiting":return t.elapsedTime>t.duration.waiting?"attack_1":"waiting";case"attack_1":return t.rate>t.targetRate.max?"sustain_1":"attack_1";case"sustain_1":return t.elapsedTime>t.duration.sustain_1?"attack_2":"sustain_1";case"attack_2":return t.rate<t.targetRate.min?"sustain_2":"attack_2";case"sustain_2":return t.elapsedTime>t.duration.sustain_2?"release":"sustain_2";case"release":return t.rate>t.targetRate.base?"init":"release";default:throw`preRate: ${t.rate}, preElapsedTime: ${t.elapsedTime}`}})(),q=n||s==="init"?{waiting:m.map(Math.random(),0,1,a.font.rate_1.waiting.min,a.font.rate_1.waiting.max),sustain_1:m.map(Math.random(),0,1,a.font.rate_1.sustain_1.min,a.font.rate_1.sustain_1.max),sustain_2:m.map(Math.random(),0,1,a.font.rate_1.sustain_2.min,a.font.rate_1.sustain_2.max)}:t.duration,A=n||s==="init"?{min:.1,max:1,base:a.font.rate_1.base}:t.targetRate,r=n||s==="init"?{attack_1:.1,attack_2:.2,release:.03}:t.coefficient,c=(()=>n||s!==t.status?0:t.elapsedTime+1)(),i=(()=>{if(n||s==="init")return A.base;if(s==="waiting")return t.rate;if(s==="attack_1")return t.rate+t.coefficient.attack_1;if(s==="sustain_1")return t.rate;if(s==="attack_2")return t.rate-t.coefficient.attack_2;if(s==="sustain_2")return t.rate;if(s==="release")return t.rate+t.coefficient.release;throw`status: ${s}`})();return{preStatus:e,status:s,duration:q,targetRate:A,coefficient:r,elapsedTime:c,rate:i}},_=(a,t)=>{const n=t===void 0,e=(()=>{if(n)return"init";switch(t.status){case"init":return"waiting";case"waiting":return a==="waiting"||a==="attack_1"||a==="sustain_1"||a==="sustain_2"?"waiting":"attack";case"attack":return t.rate<t.targetRate.max?"attack":"release";case"release":return a==="init"?"init":"release";default:throw`status_1: ${a}`}})(),s=n||e==="init"?{max:1,base:.5}:t.targetRate,q=n||e==="init"?{attack:.04,release:.04}:t.coefficient,A=(()=>{if(n||e==="init")return s.base;if(e==="waiting")return t.rate;if(e==="attack")return t.rate+q.attack;if(e==="release")return t.rate<t.targetRate.base?t.rate:t.rate-q.release;throw`status: ${e}`})();return{status:e,targetRate:s,coefficient:q,rate:A}},y=(a,t,n,e,s)=>{const q=s===void 0,A=q?new l.Vector(a%2*n*.5,Math.floor(a/2)*n*.5):s.compartmentOrigin,r=.5,c=q?[...t.font.str].map((u,o)=>new l.Vector(n*t.font.baseScaleRates[o],n*t.font.baseScaleRates[o])):s.baseScales,i=q?M(t):M(t,s.rate_1vs2and3),f=q?_(i.status):_(i.status,s.rate_2vs3),k=(()=>{const u=1-i.rate,o=[i.rate,u*f.rate,u*(1-f.rate)];return c.map((d,w)=>l.Vector.mult(d,[o[w],1]))})(),S=[...t.font.str].map((u,o)=>e.textWidth(u)*k[o].x),h=S.map((u,o,d)=>d.slice(0,o).reduce((w,C)=>l.Vector.add(w,new l.Vector(C,0)),new l.Vector(0,n*.5)));return{compartmentOrigin:A,compartmentScale:r,textWidths:S,baseScales:c,rate_1vs2and3:i,rate_2vs3:f,scales:k,poses:h}},R=(a,t,n,e)=>e===void 0?Array.from(Array(a.font.count),(q,A)=>y(A,a,t,n)):e.map((q,A)=>y(A,a,t,n,q)),I=()=>({font:{count:4,str:"バタン",baseScaleRates:[.08,.04,.05],rate_1:{waiting:{min:15,max:25},sustain_1:{min:1,max:3},sustain_2:{min:25,max:35},min:.1,max:1,base:.333}},maxVolume:-10}),L=(a,t)=>{t.pages[2].addInput(a,"maxVolume",{step:1,min:-60,max:0})},P="data:audio/mpeg;base64,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",Y="/playground/assets/temple_knok_2-fa6d4a51.mp3",F="/playground/assets/temple_knok_3-577c6421.mp3",O="/playground/assets/temple_knok_4-c506fdcf.mp3",Z="/playground/assets/temple_low_1-e331962f.mp3",j="/playground/assets/temple_low_2-783d51e5.mp3",z="/playground/assets/temple_low_3-9a40de41.mp3",J="/playground/assets/temple_low_4-e478570f.mp3",x=async a=>{const t=await B(),n=Array.from(Array(a.font.count),()=>new Q().toDestination()),e=n.map(q=>new g("8n",.2).connect(q)),s=e.map((q,A)=>{const r=()=>{if(A===0)return{A1:P,A2:Z};if(A===1)return{A1:Y,A2:j};if(A===2)return{A1:F,A2:z};if(A===3)return{A1:O,A2:J};throw`index: ${A}`};return new b({urls:r()}).connect(q)});return console.log(s[0].get()),{se:t,batann:s,batannFBDelay:e,batannPanner:n}},N=(a,t)=>{t.forEach((n,e)=>{n.ba.trigger===!0&&(a.batann[e].volume.value=1,a.batannPanner[e].pan.value=n.ba.pan_start,a.batann[e].triggerAttackRelease("A1",1),a.batannPanner[e].pan.rampTo(n.ba.pan_target,n.ba.pan_transition)),n.tan.trigger===!0&&(a.batann[e].volume.value=1,a.batannPanner[e].pan.value=n.tan.pan_start,a.batann[e].triggerAttackRelease("A2",1),a.batannPanner[e].pan.rampTo(n.tan.pan_target,n.tan.pan_transition))})},U=a=>a.map((t,n)=>{const e=()=>{const q=t.rate_1vs2and3.preStatus==="waiting"&&t.rate_1vs2and3.status==="attack_1",A=n%2===0?-1+.3:.3,r=n%2===0?-1+.8:.8;return{trigger:q,pan_start:A,pan_target:r,pan_transition:.3}},s=()=>{const q=t.rate_1vs2and3.preStatus==="sustain_1"&&t.rate_1vs2and3.status==="attack_2",A=n%2===0?-1+.5:.5,r=n%2===0?-1+.9:.9;return{trigger:q,pan_start:A,pan_target:r,pan_transition:.8}};return{ba:e(),tan:s()}}),K=(a,t,n,e)=>{e.push(),e.fill(0),a.forEach(s=>{e.push(),e.translate(s.compartmentOrigin.x,s.compartmentOrigin.y),e.scale(s.compartmentScale),T(s.poses)&&s.poses.forEach((q,A)=>{e.push(),e.translate(q.x,q.y),e.scale(s.scales[A].x,s.scales[A].y),e.text(t.font.str.charAt(A),0,0),e.pop()}),e.pop()}),e.pop(),W(e,n)},nt=a=>{const t=m.setSize("sketch");let n=p.setController();const e=I();let s,q,A;a.setup=async()=>{s=R(e,t,a),A=U(s),q=await x(e),a.createCanvas(t,t);const r=p.setGui(a,n,q.se,!1);L(e,r),a.textAlign(a.LEFT,a.CENTER),a.noLoop()},a.draw=()=>{if(q===void 0){a.noLoop();return}a.frameCount%5===0&&v({debug:!1},10),a.background(255),p.updateController(a,n),s=R(e,t,a,s),K(s,e,t,a),A=U(s),N(q,A)}};export{nt as sketch};
