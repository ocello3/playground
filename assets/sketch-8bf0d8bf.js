import{s as g,D as w,t as v,O as b,d as S,c as x}from"./tools-1a30f1ec.js";import{p as m}from"./index-92884420.js";const _=(t,e,s)=>{const n=t.length===0?{dividend:e.euclid.dividend,divisor:e.euclid.divisor}:t.slice(-1)[0];if(s!=null&&n===s[0])return s;t.length===0&&t.push(n);const r=t.length>e.euclid.thr;if(n.divisor===0||r)return t;const o=n.dividend%n.divisor,c={dividend:n.divisor,divisor:o};return t.push(c),_(t,e)},f=(t,e)=>{const s=(()=>{const i=t[0].divisor,d=t[1].divisor,l=Math.floor(t[0].dividend/t[0].divisor);return{x:t[1]===void 0?i:i*l+d,y:i}})(),n=new m.Vector(e/s.x,e/s.y),r=t.map((i,d)=>d%2===0?"x":"y"),o=t.map(i=>{if(i.divisor===0)return[new m.Vector(0,0)];const d=Math.floor(i.dividend/i.divisor);return Array.from(Array(d),()=>m.Vector.mult(n,i.divisor))}),a=o.map((i,d)=>i.map(l=>r[d]==="x"?new m.Vector(l.x,0):new m.Vector(0,l.y))).flat().map((i,d,l)=>d===0?new m.Vector(0,0):l.slice(0,d).reduce((h,p)=>m.Vector.add(h,p))),u=o.map((i,d)=>{const l=d/o.length;return i.map((h,p)=>{const y=o[0][0]===void 0?1:h.x*h.y/(o[0][0].x*o[0][0].y),I=p/i.length;return{area:y,pairIndex:l,rectIndex:I}})}).flat();return{sizes:o.flat(),positions:a,rates:u}},V=()=>({euclid:{dividend:37,divisor:27,thr:10},rect:{h_min:190,h_max:220,s_min:15,s_max:35,b_min:40,b_max:80},synth:{count:15,baseFreq:1e3,volume_min:-30,volume_max:-10}}),q=(t,e)=>{const s=e.pages[1],n=s.addFolder({title:"euclid"});n.addInput(t.euclid,"dividend",{step:1,min:2,max:1e3}),n.addInput(t.euclid,"divisor",{step:1,min:2,max:1e3}),n.addInput(t.euclid,"thr",{step:1,min:2,max:20});const r=s.addFolder({title:"rect"});r.addInput(t.rect,"h_min",{step:1,min:0,max:255}),r.addInput(t.rect,"h_max",{step:1,min:0,max:255}),r.addInput(t.rect,"s_min",{step:1,min:0,max:255}),r.addInput(t.rect,"s_max",{step:1,min:0,max:255}),r.addInput(t.rect,"b_min",{step:1,min:0,max:255}),r.addInput(t.rect,"b_max",{step:1,min:0,max:255});const o=e.pages[2];o.addInput(t.synth,"baseFreq",{step:1,min:100,max:2e3}),o.addInput(t.synth,"volume_min",{step:1,min:-60,max:-20}),o.addInput(t.synth,"volume_max",{step:1,min:-20,max:-5})},z=()=>{const t=new b(440,"sine").toDestination();return t.mute=!0,t.start(),t},F=async t=>{const e=await g(),s=Array.from(Array(t.synth.count),()=>z());return console.log(w.get()),{se:e,oscillators:s}},k=(t,e,s)=>{const n=e.sizes.length>s.synth.count?s.synth.count:e.sizes.length,r=e.rates.map(c=>s.synth.baseFreq*c.pairIndex*c.rectIndex),o=e.rates.map(c=>v.map(c.area/n,0,1,s.synth.volume_min,s.synth.volume_max));t.oscillators.forEach((c,a)=>{if(a>e.sizes.length)return;const u=r[a],i=o[a]===void 0?0:o[a];c.frequency.value=u,c.volume.value=i})},A=(t,e,s,n)=>{n.push(),n.noStroke(),t.sizes.forEach((r,o)=>{const c=t.positions[o],a=t.rates[o],u=v.map(a.area,0,1,e.rect.h_min,e.rect.h_max),i=v.map(a.pairIndex,0,1,e.rect.s_max,e.rect.s_min),d=v.map(a.rectIndex,0,1,e.rect.b_min,e.rect.b_max);n.fill(u,i,d),n.rect(c.x,c.y,r.x,r.y)}),n.pop(),S(n,s)},D=t=>{const e=v.setSize("sketch");let s=x.setController();const n=V();let r,o,c;t.setup=async()=>{c=await F(n),r=_([],n),o=f(r,e),t.createCanvas(e,e);const a=x.setGui(t,s,c.se,!1);q(n,a),t.colorMode(t.HSB),t.noLoop(),t.frameRate(10)},t.draw=()=>{if(c===void 0){t.noLoop();return}t.background(255),x.updateController(t,s),r=_([],n,r),o=f(r,e),A(o,n,e,t),t.frameCount>1&&k(c,o,n)}};export{D as sketch};
