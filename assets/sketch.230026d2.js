import{T as V,o as g,P as T,r as I,S as G,G as b,a as ht,b as B,M as ut,e as N,f as lt,O as Z,A as pt,g as dt,W as mt,i as H,t as S,s as ft,D as _t,h as tt,j as gt,c as Y,d as J}from"./tools.624a8220.js";import{p as m}from"./index.b39c393f.js";import{G as xt}from"./GrainPlayer.fd09c64e.js";class M extends V{constructor(){super(g(M.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=g(M.getDefaults(),arguments,["delayTime","maxDelay"]),s=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(s,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(s),this.delayTime=new T({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),I(this,"delayTime")}static getDefaults(){return Object.assign(V.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class $ extends G{constructor(){super(Object.assign(g($.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new b({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,ht(this._constantSource,this._sum)}static getDefaults(){return Object.assign(G.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class L extends B{constructor(){super(Object.assign(g(L.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=g(L.getDefaults(),arguments,["min","max"]);this._mult=this.input=new ut({context:this.context,value:t.max-t.min}),this._add=this.output=new $({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(B.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class X extends B{constructor(){super(Object.assign(g(X.getDefaults(),arguments))),this.name="Zero",this._gain=new b({context:this.context}),this.output=this._gain,this.input=void 0,N(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),lt(this.context.getConstant(0),this._gain),this}}class W extends V{constructor(){super(g(W.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=T.prototype._fromType,this._toType=T.prototype._toType,this._is=T.prototype._is,this._clampValue=T.prototype._clampValue;const t=g(W.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new Z(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new b({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new G({context:this.context,units:"audioRange",value:0}),this._zeros=new X({context:this.context}),this._a2g=new pt({context:this.context}),this._scaler=this.output=new L({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),I(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(Z.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const s=this.min,n=this.max;this._units=t,this.min=s,this.max=n}get state(){return this._oscillator.state}connect(t,s,n){return(t instanceof T||t instanceof G)&&(this.convert=t.convert,this.units=t.units),dt(this,t,s,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}class yt extends B{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new mt({context:this.context,mapping:t=>Math.abs(t)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class q extends V{constructor(){super(Object.assign(g(q.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new yt({context:this.context}),this.a=new b({context:this.context,gain:0}),this.b=new b({context:this.context,gain:0}),this.output=new b({context:this.context}),this._internalChannels=[this.a,this.b];const t=g(q.getDefaults(),arguments,["fade"]);this.fade=new G({context:this.context,units:"normalRange",value:t.fade}),I(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",N(this._split,this.a.gain,0),N(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(V.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class K extends V{constructor(t){super(t),this.name="Effect",this._dryWet=new q({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new b({context:this.context}),this.effectReturn=new b({context:this.context}),this.input=new b({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],I(this,"wet")}static getDefaults(){return Object.assign(V.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Q extends K{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new b({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,I(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(K.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class E extends Q{constructor(){super(g(E.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=g(E.getDefaults(),arguments,["pitch"]);this._frequency=new G({context:this.context}),this._delayA=new M({maxDelay:1,context:this.context}),this._lfoA=new W({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new M({maxDelay:1,context:this.context}),this._lfoB=new W({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new q({context:this.context}),this._crossFadeLFO=new W({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new M({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,I(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const s=this.now();this._lfoA.start(s),this._lfoB.start(s),this._crossFadeLFO.start(s),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(Q.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let s=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,s=H(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,s=H(t)-1),this._frequency.value=s*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}const et=()=>({surfaceYPosRate:.4,g:.3,mMin:25,mMax:100,initPosMaxRate:1.2,text:"Create pockets",cd:2,rotateSpeedRate:.01,angleRangeRate:.007,fontAvatorNum:2,fontAvatorAngleGap:.4}),st=et(),wt=(e,t)=>{const s=t.pages[1];s.addInput(e,"surfaceYPosRate",{step:.1,min:.2,max:.8}),s.addInput(e,"g",{step:.1,min:.2,max:1.2}),s.addInput(e,"mMin",{step:1,min:5,max:20}),s.addInput(e,"mMax",{step:1,min:50,max:150}),s.addInput(e,"initPosMaxRate",{step:.1,min:.1,max:1.5}),s.addInput(e,"cd",{step:.1,min:.5,max:4})},U=(e,t)=>{const{surfaceYPosRate:s,text:n,fontAvatorNum:i,fontAvatorAngleGap:h}=e,u=n.length;return{num:u,mArray:Array.from(Array(u),()=>0),textWidthArray:Array.from(Array(u),()=>0),surfaceYPos:t*s,isReset:!0,isWaiting:!0,progressRateInWater:0,nearestXPos:0,flooders:Array.from(Array(u),(r,p)=>({isInWater:!1,isAttached:!1,m:0,v:new m.Vector().set(0,0),a:new m.Vector().set(0,0),pos:new m.Vector().set(0,0),font:n[p],isOver:!0,angles:Array.from(Array(i),(f,A)=>A*h*Math.PI)}))}};U(st,100);const bt=(e,t,s,n)=>{const{mMin:i,mMax:h,g:u,initPosMaxRate:r,cd:p,angleRangeRate:d,rotateSpeedRate:f,fontAvatorAngleGap:A}=t,c={...e},{isReset:y,surfaceYPos:k}=e;c.mArray=(()=>y?Array.from(Array(e.num),()=>S.map(Math.random(),0,1,i,h)):e.mArray)(),c.textWidthArray=(()=>y?c.mArray.map((a,_)=>(n.textSize(a),n.textWidth(e.flooders[_].font))):e.textWidthArray)(),c.flooders=e.flooders.map((a,_)=>{const o={...a},O=()=>m.Vector.add(a.pos,o.v);return o.m=c.mArray[_],o.a=(()=>{if(a.isInWater){const R=m.Vector.mag(a.v),v=m.Vector.normalize(a.v),x=Math.pow(R,2)*p*v.y*-1/o.m;return new m.Vector().set(0,x)}return new m.Vector().set(0,0)})(),o.v=(()=>{if(y)return n.createVector(0,0);const R=m.Vector.add(n.createVector(0,u),o.a);return m.Vector.add(a.v,R)})(),o.pos=(()=>{if(y){const v=c.textWidthArray.slice(0,_).reduce((x,w)=>x+w,0),P=-1*Math.random()*r*s;return n.createVector(v,P)}return O()})(),o.angles=a.angles.map((R,v)=>{if(a.isInWater){const P=d*Math.PI*m.Vector.mag(o.v),x=P*-1,w=P,z=n.frameCount*f*o.m;if(v===0)return n.map(Math.sin(z),0,1,x,w);if(v===1)return n.map(Math.sin(z*A),0,1,x,w)}return 0}),o.isInWater=o.pos.y>k,o.isAttached=!a.isInWater&&o.isInWater,o.isOver=o.pos.y>s*(1+r)||o.pos.y<-1*r*s,o}),c.isWaiting=(()=>{for(const a of c.flooders)if(a.isInWater===!0)return!1;return!0})(),c.isReset=(()=>{for(const a of c.flooders)if(a.isOver===!1)return!1;return!0})();const l=c.flooders.map(a=>a.pos.y-k),D=(()=>c.isWaiting||c.isReset?0:l.reduce((a,_)=>a<_||_<0?a:_,s))();return c.nearestXPos=(()=>{const a=l.indexOf(D),o=c.flooders.map(O=>O.pos.x)[a];return typeof o=="number"?o:s*.5})(),c.progressRateInWater=(()=>{const a=D/(s-k);return a>1?1:a})(),c},St=(e,t,s,n)=>{const{surfaceYPos:i}=e;n.push(),n.noStroke(),n.fill(181,141,182,40),n.rect(0,i,t,t-i),n.pop(),n.push(),n.textAlign(n.CENTER,n.BASELINE),n.textFont(s);for(const h of e.flooders){const{m:u,font:r,pos:p,isInWater:d,angles:f}=h,A=d?150:250;n.push(),n.textSize(u),n.translate(p.x,p.y),f.forEach((c,y)=>{n.push(),y===0&&n.fill(208,173,167,A),y===1&&n.fill(173,106,108,A*.4),n.rotate(c),n.text(r,0,0),n.pop()}),n.pop()}n.pop()},C={setParams:et,setGui:wt,setData:U,updateData:bt,draw:St},At=()=>({ampCf:.8,phaseVel:.03,cycleRate:.005,intervalRate:.005,ampRate:15e-5}),Dt=(e,t)=>{const s=t.pages[1];s.addSeparator(),s.addInput(e,"ampCf",{step:.1,min:.1,max:1}),s.addInput(e,"phaseVel",{step:.01,min:.01,max:.1}),s.addInput(e,"cycleRate",{step:.001,min:.001,max:.01}),s.addInput(e,"intervalRate",{step:.001,min:.001,max:.01}),s.addInput(e,"ampRate",{min:5e-5,max:.001})},nt=e=>{const{num:t}=e;return{bubbleLines:Array.from(Array(t),()=>({phase:0,cycle:0,interval:0,originPos:new m.Vector(0,0),num:0,amp:0,isDraw:!1,bubbles:[{pos:new m.Vector(0,0),alpha:0,size:0}]}))}},vt=U(st,100);nt(vt);const Rt=(e,t,s,n,i)=>{const h={...t},{surfaceYPos:u,flooders:r}=e,{ampCf:p,phaseVel:d,cycleRate:f,intervalRate:A,ampRate:c}=s;return h.bubbleLines=t.bubbleLines.map((y,k)=>{const l={...y},D=r[k];if(l.cycle=n*D.m*f,l.interval=l.cycle*D.m*A,l.originPos=D.pos,l.num=Math.floor((l.originPos.y-u)/l.interval),l.amp=n*D.m*c,l.phase=y.phase+d,l.isDraw=l.num>1,!l.isDraw)return l;const{originPos:a,num:_,cycle:o,interval:O,amp:R,phase:v}=l;return l.bubbles=Array.from(Array(_),(P,x)=>{const w=(()=>{const z=x*O+u,ot=z*2*Math.PI/o+v,rt=R*Math.pow(x,p),ct=Math.sin(ot)*rt+a.x;return i.createVector(ct,z)})();return{pos:w,alpha:i.noise(w.x,w.y)*x*10,size:i.noise(w.x,w.y)*Math.pow(x,.3)*D.m*.15}}),l}),h},Vt=(e,t)=>{t.push(),t.noStroke();for(const s of e.bubbleLines){const{bubbles:n,isDraw:i}=s;i&&n.forEach((h,u)=>{const{pos:r,alpha:p,size:d}=h;t.fill(208,173,167,p),u!=0&&t.circle(r.x,r.y,d)})}t.pop()},F={setParams:At,setGui:Dt,setData:nt,updateData:Rt,draw:Vt},Pt="/playground/assets/toggle_on.bf4c5ffc.wav",at="/playground/assets/toggle_off.97d6cba3.wav",Tt=()=>({maxVolume:-15,minVolume:-40,grainMaxVolume:-23,minPitch:-20,maxPitch:20}),Mt=(e,t)=>{t.pages[2].addInput(e,"maxVolume",{step:1,min:-60,max:0})},Wt=()=>{const e=new tt(.5).toDestination(),t=new E().connect(e),s=new gt({urls:{A1:Pt,A2:at}}).connect(t);return{panner:e,pitchShift:t,instrument:s}},Gt=()=>{const e=new tt(.5).toDestination(),t=new xt({url:at,loop:!0,grainSize:.06,overlap:.1,playbackRate:2.5,onload:()=>{t.volume.value=-60,t.connect(e),t.start()}});return{panner:e,source:t}},it=async()=>{const e=Wt(),t=Gt(),s=await ft();return _t.mute=!0,{tapSampler:e,grainPlayer:t,se:s}};await it();const It=(e,t,s,n,i)=>{e.flooders.forEach((h,u)=>{if(h.isAttached){const r=S.constrain(S.map(h.pos.x,0,i,-1,1),-1,1),p=S.map(h.m,t.mMin,t.mMax,s.maxVolume,s.minVolume),d=S.map(t.mMax-h.m,t.mMin,t.mMax,s.minPitch,s.maxPitch),f=u%2===0?"A1":"A2";n.tapSampler.panner.pan.value=r,n.tapSampler.pitchShift.pitch=d,n.tapSampler.instrument.volume.value=p,n.tapSampler.instrument.triggerAttackRelease(f,.1)}})},kt=(e,t,s,n)=>{const{progressRateInWater:i,nearestXPos:h}=e,u=S.map(1-i,0,1,-35,t.grainMaxVolume),r=S.constrain(S.map(h,0,n,-1,1),-1,1);i===0?s.grainPlayer.source.mute=!0:(s.grainPlayer.source.volume.value=u,s.grainPlayer.panner.pan.value=r)},Ot=(e,t,s,n,i)=>{It(e,t,s,n,i),kt(e,s,n,i)},j={setParams:Tt,setGui:Mt,setSynth:it,playSynth:Ot},zt="/playground/assets/Fascinate-Regular.5a20fb9b.ttf",jt=async e=>{const t=S.setSize("sketch");let s,n=Y.setController();const i=C.setParams(),h=F.setParams(),u=j.setParams();let r=C.setData(i,t),p=F.setData(r),d;e.preload=()=>{s=e.loadFont(zt)},e.setup=async()=>{e.createCanvas(t,t),d=await j.setSynth();const f=Y.setGui(e,n,d.se,!1);C.setGui(i,f),F.setGui(h,f),j.setGui(u,f),e.noLoop(),J(e,t)},e.draw=()=>{d===void 0&&e.noLoop(),e.background(255),Y.updateController(e,n),r=C.updateData(r,i,t,e),p=F.updateData(r,p,h,t,e),C.draw(r,t,s,e),F.draw(p,e),J(e,t),j.playSynth(r,i,u,d,t)}};export{jt as sketch};
